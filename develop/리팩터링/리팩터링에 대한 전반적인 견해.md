### 리팩터링의 정의

- 리팩터링 
  - Software의 겉보기 동작은 그대로 유지한 채. 코드를 이해하고, 수정하기 쉽도록 내부 구조를 변경하는 기법이다.

`리팩터링을 하다 코드가 깨졌다` 라고 한다면 그것은 리팩터링이 아니다.

- Restructuring (재구성)
  - Code base를 정리하거나 구조를 바꾸는 모든 작업을 칭한다.

- Refactoring 
  - 모든 Restructuring 중에서 도중에 중단되더라도 동작이 유지되어야 하는 것이다.
    
Restructuring 안에 Refactoring 을 내포하고 있다. 

즉, 리팩터링은 그 과정에서의 겉보기 동작 유지가 중요한 것이다. 리팩터링의 특징은 무엇을 하느냐가 아닌 어떻게 하느냐이다.

#### 두 개의 모자

기능 추가와 리팩터링을 명확하게 구분하라.

예시로, CR(Code Review)를 요청했다. 해당 Commit의 목적은 기능 추가였다.
그러나 코드 수정을 위해 (js circular dependency) 리팩터링을 해야만 했다.
때문에 이 Commit에는 리팩터링과 기능추가가 같이 들어간 예시이다.

추가된 코드 라인이 리팩터링인지 기능추가인지 어떻게 구분할 것인가?
그리고 어떤 코드가 파일 A에서 파일 B로 옮겨졌다. 그 후에 기능추가가 이루어졌을 때라면, 기능 추가로 수정된 사항을 Diff로 알 수가 없다.

리팩터링 모자를 썼을 때는 심지어 `테스트`마저 수정하지 않는다.

> 단, "리팩터링 커밋과 기능추가 커밋을 분리해야 한다는 조언... 완전히 동의하지 않는다.
> 리팩터링은 기능추가와 밀접하게 엮인 경우가 너무 많기 때문에 굳이 나누는 것은 시간낭비일 수 있다."
> (계획된 리팩터링과 수시로 하는 리팩터링)

이것에 대해 대안책들 중 하나로는 최종 Commit으로 하나로 묶되, CR은 여러 Revision으로 나누어 검토하는 것이 좋다.

Git의 Stash/Commit/Rebase 등의 기능을 잘 활용할 수 있다면, 예술적으로 적용할 수 있다.

### 리팩터링. 왜 하는가?

- Software 설계가 좋아진다.
- Software를 이해하기 쉬워진다.
- 버그를 쉽게 찾을 수 있다.

 즉, 프로그래밍 속도를 높일 수 있다.

#### 설계 지구력 가설

내부 설계에 심혈을 기울이면 Software의 지구력이 높아져서 빠르게 개발할 수 있는 상태를 더 오래 지속할 수 있게 된다.

### 리팩터링. 언제 해야할까?

#### 3의 법칙 - 3진 아웃 리팩터링

1. 일단 개발한다.
2. 같은 일을 두 번 하게 된다면.. 그래도 일단 한다.
3. 또 같은 일을 하게 될 때, 그 때 리팩터링을 시도한다.

#### 준비를 위한 리팩터링 - 기능을 쉽게 추가해 만들기

기능을 추가하기 직전에, `리팩터링을 하면 쉽게 추가할 수 있지 않을까`를 고민해보기

#### 이해를 위한 리팩터링 - 코드를 이해하기 쉽게 만들기

코드를 파악해야할 일이 있을 때, 이해한 내용을 더 잘 반영할 수 있도록 리팩터링

#### 쓰레기 줍기 리팩터링

코드를 파악하다가 `비효율적으로 처리하는 모습을 발견`하면 리팩터링한다.


#### 수시로 하는 리팩터링

따로 하지는 않는다. 개발하는 과정에서 진행해도 무관

#### CR에 리팩터링 활용하기

CR할 때, 실제로 리팩터링 진행하기. 하지만 리팩터링을 하지 말아야 할 때는 지저분해도 굳이 수정할 필요가 없다면 안 해도 된다.
차라리 새로 작성하는 게 쉬울 때가 바로 그 때다.


이렇게 나열했지만, 실질적으로는 준비를 위한 리팩터링 때 진행한다. Amazon 팀의 실질적 리팩터링 분포도를 확인해 보면,
CR 때 많이 진행한다고 한다. 하지만 주의사항으로 팀에 따라 업무 체계가 다른 특성상, 팀에 따라 차이가 클 수 있다.

자신의 업무 체계에 따른 리팩터링 활용 방안을 고심해보아야 한다는 것.

### 리팩터링. 성능은?

#### 직관적 설계 VS 성능

리팩터링은 이해하기 쉬운 코드를 위해 `속도가 느려지는` 방향인 경우가 많다.

성능이 느려져도 상관없으니 보기 좋은 코드가 좋은 게 좋을까? 하드웨어가 발전해서 그정도 성능저하는 아무 문제도 없을 것.  
성능을 튜닝하기는 쉬워지기 때문에 오히려 성능이 좋아진다.

#### 90 퍼센트의 시간은 낭비다.

1. 성능에 신경쓰지 않고, 보기 좋게 코딩한다.
2. 성능 최적화 단계가 되면, 프로파일러로 분석하여 오랜 시간을 잡아 먹는 코드를 특정해낸다.
3. 그 부분을 개선하면 된다!

- 리팩터링이 잘 된 코드는 성능 분석에 유리하다.